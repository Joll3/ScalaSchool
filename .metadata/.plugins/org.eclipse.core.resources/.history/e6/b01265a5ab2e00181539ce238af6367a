
# This assignment asks you to find the most frequent value in a data array.
        
# Namely, you must find the most frequently occurring value in a data
# array that starts at memory address $0 and contains $1 words.
# The most frequent value must be stored in register $2.
# Complete and submit the part delimited by "----" and indicated
# by a "nop" below.

# Here is some wrapper code to test your solution:

        mov     $0, >test_data  # set up the address where to get the data
        mov     $1, >test_len   # set up address where to get the length
        loa     $1, $1          # load the length from memory to $1

# Your solution starts here ...
# ------------------------------------------

      add $1, $1, $0
      sub $1, $1, 1           # address of the last data item
@select_loop:
      cmp $0, $1              # compare start address and last address
      bae >done               # ... if start addr >= last addr, we are done
      loa $2, $0              # set up a candidate maximum
      mov $3, $0              # set up address of candidate maximum
      add $4, $0, 1           # set up current address
@max_scan_loop:
      cmp $4, $1              # compare current address with last address
      bab >scan_done          # ... if curr addr > last addr, we have the max
      loa $5, $4              # load current data item
      cmp $5, $2              # compare current item with candidate max
      bbe >no_update          # ... if current <= candidate, no need to update
      mov $2, $5              # update candidate maximum
      mov $3, $4              # update address of candidate maximum
@no_update:
      add $4, $4, 1           # advance to next element
      jmp >max_scan_loop      # continue scanning
@scan_done:
      # at this point $2 is the max item and $3 is its addr in array
      # transpose max item and last item in current array ...
      sub $4, $4, 1           # address of last item
      loa $5, $4              # load last item
      sto $4, $2              # store max to last position
      sto $3, $5              # store last item to max position
      sub $1, $1, 1           # remove last item (now =max) from consideration
      jmp >select_loop        # continue sorting the remaining array

#SORT DONE-----------------------------------------------------------------------------
      
      mov $7, 1				#current frequenqy count 
      mov $6, 1				#max frequenqy count
      mov $5, 0				#max frequeny value address 
      loa $4, $0				#value being checked (first value already setup)
      mov $3, 0				#next value, going to be checked 
      mov $2, $0				#current address (starting from first address to get data from)
      
      add $1, $1, $0
      sub $1, $1, 1			#last address where to get data from

@scan_values:
      cmp $2, $1				# compare current address w last address
      bae >done				# ... if current address >= last address DONE
      
      loa $3, $2				# load value from current address to $3
      cmp $4, $3				#compare value being checked to next value  
      bne >noupdate			#... if != nothing changes and we move onto next one
      add $7, $7, 1			#otherwise we update the current frequent count
      cmp $6, $7				#compare max frequency count with current frequency count
      bab >noupdate			#... if max frequeny count > current frequency count, we continue looking for new values
      mov $6, $7				#update current count to be largest
      mov $5, $2				#update max frequency address to current address
      
      add $2, $2, 1			#ADD one to current address
      
      jmp >scan_values  
      
 
@noupdate:
	 add $2, $2, 1
	 jmp >scan_values
	
@done:
	mov $2, $5
# ------------------------------------------
# ... and ends here 

        hlt                     # the processor stops here

# Here is the test data:
# (the most frequent value is 56369 with frequency 5 in the array)

@test_len:
        %data   23
@test_data:
        %data   18701, 1100, 590, 17017, 56369, 19296, 1100, 56369, 1100, 56369, 590, 18701, 19296, 19296, 56369, 1100, 55034, 590, 29135, 18701, 18701, 29135, 56369

